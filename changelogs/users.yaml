databaseChangeLog:
  - changeSet:
      id: 20
      author: kacper
      changes:
        - sql:
            comment: "Funkcja ustawiająca kolumnę insstmp na aktualny timestamp przy insercie"
            sql: |
              CREATE OR REPLACE FUNCTION public.insert_insstmp()
              RETURNS trigger
              LANGUAGE plpgsql
              AS $$
              BEGIN
                  NEW.insstmp := CURRENT_TIMESTAMP;
                  RETURN NEW;
              END;
              $$;
  - changeSet:
      id: 20
      author: kacper
      changes:
        - sql:
            comment: "Funkcja ustawiająca kolumnę insstmp na aktualny timestamp przy insercie"
            sql: |
              CREATE OR REPLACE FUNCTION public.update_updstmp()
              RETURNS trigger
              LANGUAGE plpgsql
              AS $$
              BEGIN
                NEW.updstmp := CURRENT_TIMESTAMP;
                RETURN NEW;
              END;
              $$;
  - changeSet:
      id: 22
      author: kacper
      changes:
        - createTable:
            tableName: users
            columns:
              - column:
                  name: id
                  type: INT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
                  comment: "ID, PK, dodany autoincrement" 
              - column:
                  name: email
                  type: varchar(50)
                  constraints:
                    nullable: false
              - column:
                  name: login
                  type: varchar(30)
                  constraints:
                    nullable: false
              - column:
                  name: is_active
                  type: bolean
                  constraints:
                    nullable: false
              - column:
                  name: insstmp
                  type: date
                  constraints:
                    nullable: false
                  comment: "Data kiedy powstał wpis. Wrzucony trigger trg_insert_insstmp_users"
			        - column:
                  name: updstmp
                  type: date
                  constraints:
                    nullable: false
                  comment: "Data kiedy był zrobiony ostatni update na tym wierszu. Wrzucony trigger trg_update_updstmp_users"
  - changeSet:
      id: 23
      author: kacper
      changes:
        - sql:
            comment: "Trigger aktualizujący kolumnę updstmp przy aktualizacji"
            sql: |
              CREATE OR REPLACE TRIGGER trg_update_updstmp_users
              BEFORE INSERT OR UPDATE ON users
              FOR EACH ROW
              EXECUTE FUNCTION update_updstmp();

  - changeSet:
      id: 24
      author: kacper
      changes:
        - sql:
            comment: "Trigger ustawiający kolumnę insstmp przy wstawieniu nowego wiersza"
            sql: |
              CREATE OR REPLACE TRIGGER trg_insert_insstmp_users
              BEFORE INSERT ON users
              FOR EACH ROW
              EXECUTE FUNCTION insert_insstmp();
